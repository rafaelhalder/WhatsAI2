generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = "postgres://postgres:78ffa3b05805066f6719@banco_halder-db:5432/halder?sslmode=disable"
}

model User {
  id       String @id @default(cuid())
  username String @unique
  password String
  
  conversations Conversation[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("users")
}

model Instance {
  id             String  @id @default(cuid())
  instanceName   String  @unique
  instanceId     String? @unique
  qrCode         String?
  status         String  @default("DISCONNECTED")
  profilePicUrl  String?
  profileName    String?
  profileStatus  String?
  
  conversations Conversation[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("instances")
}

model Conversation {
  id          String @id @default(cuid())
  instanceId  String
  chatId      String
  chatName    String?
  isGroup     Boolean @default(false)
  lastMessage String?
  timestamp   DateTime @default(now())
  
  userId      String?
  user        User?     @relation(fields: [userId], references: [id])
  instance    Instance  @relation(fields: [instanceId], references: [id])
  messages    Message[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([instanceId, chatId])
  @@map("conversations")
}

model Message {
  id             String   @id @default(cuid())
  conversationId String
  messageId      String   @unique
  fromMe         Boolean  @default(false)
  body           String?
  type           String   @default("text")
  timestamp      DateTime @default(now())
  
  conversation Conversation @relation(fields: [conversationId], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("messages")
}